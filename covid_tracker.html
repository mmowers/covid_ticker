<!DOCTYPE html>
<html>
<head>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
<title>Covid ticker</title>
<style>
</style>
<script>
</script>

<body>
<div id='num'>Counter</div>
<script>
var covid_data_url = 'https://raw.githubusercontent.com/nittyjee/coronastate/master/data/overall_summary.csv'

$.ajax({ url: covid_data_url, success: function(data) {
	var data_arr = Papa.parse(data,{ header: true });
	data_arr = data_arr['data'];
	var today = new Date();
	var dd   = today.getDate();
	var mm   = today.getMonth()+1; //January is 0!
	var yyyy = today.getFullYear();
	if(dd<10)  { dd='0'+dd } 
	if(mm<10)  { mm='0'+mm } 
	var today_str = yyyy + '-' + mm+'-'+dd;

	var two_days_ago = new Date();
	two_days_ago.setDate(two_days_ago.getDate() - 2);
	var dd   = two_days_ago.getDate();
	var mm   = two_days_ago.getMonth()+1; //January is 0!
	var yyyy = two_days_ago.getFullYear();
	if(dd<10)  { dd='0'+dd } 
	if(mm<10)  { mm='0'+mm } 
	var two_days_ago_str = yyyy + '-' + mm+'-'+dd;

	var one_week_two_days_ago = new Date();
	one_week_two_days_ago.setDate(one_week_two_days_ago.getDate() - 9);
	var dd   = one_week_two_days_ago.getDate();
	var mm   = one_week_two_days_ago.getMonth()+1; //January is 0!
	var yyyy = one_week_two_days_ago.getFullYear();
	if(dd<10)  { dd='0'+dd } 
	if(mm<10)  { mm='0'+mm } 
	var one_week_two_days_ago_str = yyyy + '-' + mm+'-'+dd;

	for(var i = data_arr.length - 1; i > 0; i--) {
		var brk = 5;
		if(data_arr[i].date == today_str){
			var today_cases = data_arr[i].cases;
		}
		if(data_arr[i].date == two_days_ago_str){
			var two_days_ago_case = data_arr[i].cases;
		}
		if(data_arr[i].date == one_week_two_days_ago_str){
			var one_week_two_days_ago_case = data_arr[i].cases;
			break;
		}
	}
	var daily_case = (parseInt(two_days_ago_case) - parseInt(one_week_two_days_ago_case))/7;

	var ms_per_case = (1/daily_case)*24*60*60*1000;

	var case_count = parseInt(today_cases);

	window.setInterval(tick, ms_per_case);
	function tick() {
		case_count++;
		document.getElementById('num').innerHTML = case_count.toString();
	}

}});

</script>
</body>
</html>